!function($){$.loader_ext={defaults:{autoCheck:32,css:{},size:16,bgColor:"#FFF",bgOpacity:.5,fontColor:!1,position:[0,0,0,0],title:"",isOnly:!0,imgUrl:"./assets/images/loading[size].gif",onShow:function(){},onClose:function(){}},template:function(tmpl,data){return $.each(data,(function(k,v){tmpl=tmpl.replace("${"+k+"}",v)})),$(tmpl)},init:function(scope,options){if(this.options=$.extend({},this.defaults,options),this.scope=scope,!this.scope.is(":hidden"))return this.checkScope(),this.check_position(),this.check_unique(),this.create(),this.set_css(),this.set_define(),this.show(),this.loading},checkScope:function(){this.options.autoCheck&&((this.scope.is("body")||this.scope.is("div")||this.scope.is("form"))&&(this.options.size=this.options.autoCheck),(this.scope.is("input")||this.scope.is("button"))&&(this.options.title=""))},check_position:function(){for(var pos=this.options.position,i=0;i<4;i++)void 0===pos[i]&&(pos[i]=0);this.options.position=pos},check_unique:function(){this.options.isOnly&&void 0!==this.loading&&this.close()},create:function(){var ops=this.options;ops.imgUrl=ops.imgUrl.replace("[size]",ops.size+"x"+ops.size),this.loading=this.template($.loader.tmpl,{Class:"x"+ops.size,Src:ops.imgUrl,Title:ops.title}).hide(),this.loading.appendTo($("body"))},set_css:function(){var scope=this.scope,ops=this.options,loading=this.loading,height=scope.outerHeight(),width=scope.outerWidth(),top=scope.offset().top,left=scope.offset().left;loading.css("top",top),scope.is("body")&&(height=$(window).height(),width=$(window).width(),loading.css("position","fixed"),this.for_ie6()),loading.css({height:height+ops.position[2],width:width+ops.position[3],left:left,"border-radius":scope.css("border-radius")}).css(ops.css);var loader=loading.children();loader.css({"margin-top":(height-ops.size)/2+ops.position[0],"margin-left":(width-ops.size)/2+ops.position[1]-loader.find("span").outerWidth()/2})},set_define:function(){var ops=this.options,loading=this.loading;ops.bgColor?loading.css({"background-color":ops.bgColor,opacity:ops.bgOpacity,filter:"alpha(opacity="+100*ops.bgOpacity+")"}):loading.css("background","none"),ops.fontColor&&loading.find("span").css("color",ops.fontColor);var self=this;$(window).resize((function(){self.loading&&self.set_css()}))},for_ie6:function(){var loading=this.loading;$.browser&&$.browser.msie&&"6.0"==$.browser.version&&(loading.css({position:"absolute",top:$(window).scrollTop()}),$(window).scroll((function(){loading.css("top",$(window).scrollTop())})))},show:function(){var ops=this.options;this.loading.show(1,(function(){var loader=$(this).children(),left=loader.css("margin-left").replace("px","");loader.css("margin-left",left-loader.find("span").outerWidth()/2),ops.onShow(this.loading)}))},close:function(all){if(all){var className=$($.loader.tmpl).attr("class");$("."+className).remove()}else null!=this.loading&&(this.loading.remove(),this.loading=void 0);null!=this.options&&this.options.onClose()}},$.loader={tmpl:'<div class="loading_wrp"><div class="loading ${Class}"><img src="${Src}" /><span>${Title}</span></div></div>',open:function(arg){return $("body").loader(arg)},close:function(all){$.loader_ext.close(all)}},$.fn.loader=function(arg){if($(this).length){"string"===$.type(arg)&&(arg={title:arg});var dom=$(this);return dom.length>1&&(dom=dom.parent()),$.loader_ext.init(dom,arg)}}}(jQuery);